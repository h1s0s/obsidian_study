# EC2 세팅

## 보안 그룹

![](https://velog.velcdn.com/images/boo105/post/eaed79d0-7e4b-4320-830f-000656ff6186/image.png)

HTTP, HTTPS 가 허용되어 있어야 합니다.

## 도메인과 EC2 연결

### Rout53

- 호스팅 영역 생성  
    ![](https://velog.velcdn.com/images/boo105/post/7ee332ef-fea4-4231-9899-f61b1cfd974d/image.png)

발급받으신 도메인을 입력해 생성하시면 됩니다.

- 레코드 세트 생성
    - EC2 IP 연결  
        ![](https://velog.velcdn.com/images/boo105/post/d1c74f8d-66c8-47e0-9999-0b937c8c4996/image.png)

값에다가 EC2 Public IP를 입력해주시면 됩니다.  
여기서 www.도메인 을 사용하시고 싶으시면 레코드 이름에 www 를 입력해주시면 됩니다.  
(레코드를 여러개 추가해서 [도메인, www.도메인] 둘다 사용 가능합니다.)

- 네임서버 설정  
    ![](https://velog.velcdn.com/images/boo105/post/baaecfb4-eab4-4fc0-b3cf-367b39755e4f/image.png)

## SSL 인증서 발급

### Let’s Encrypt

무료 SSL 인증서

### 발급 방식

- **standalone**
    - 사이트 작동을 멈추고 이 사이트의 네트워킹을 이용해 사이트 유효성을 확인해 SSL 인증서 발급
    - 동시에 여러 도메인 발급 가능
    - 자동갱신 가능
- **webroot**
    - 사이트 디렉토리 내에서 인증서 유효성을 확인할 수 있는 파일을 업로드하여 인증서 발급
    - 실제 작동하고 있는 웹서버의 특정 디렉토리의 특정 파일 쓰기 작업을 통해서 인증
    - 서버 중단없이 발급 가능
    - 하나의 도메인 인증서만 발급 가능
    - 자동갱신 가능
- **DNS**
    - 도메인을 쿼리해 확인되는 TXT 레코드로 사이트 유효성을 확인하는 방법
    - 와일드 카드 방식으로 인증서를 발급
    - 인증서 갱신마다 DNS에서 TXT값을 변경해야 함

먼저 SSH로 EC2 인스턴스에 접속해봅시다. 그리고 certbot을 사용해 SSL 인증서를 발급 받을거에요.

`sudo yum install certbot`

- EC2 리눅스에서 certbot 설치하는 법

`sudo certbot certonly —standalone`

- 발급 받은 도메인을 입력해서 SSL 인증서를 발급 받습니다.  
    ![](https://velog.velcdn.com/images/boo105/post/88fee6eb-6a52-4b6e-bd70-8255bcf76a90/image.png)

발급이 성공하게 되면 `/etc/letsencrypt/live/도메인` 경로에 fullchain.pem 과 privkey.prem이 발급이 되었다고 나옵니다. 해당 경로로 이동합니다. (참고로 root 계정으로 이동해야 합니다.)

`sudo openssl pkcs12 -export -in fullchain.pem -inkey privkey.pem -out keystore.p12 -name ttp -CAfile chain.pem -caname root`

- .pem은 스프링부트에서 인식못하기 때문에 pem을 PKCS12 형식으로 변경합니다.
- 명령어를 실행하고 나면 비밀번호를 입력하는데 입력해주시고 꼭 기억해주세요.
- 결과물 : keystore.p12

이렇게 발급한 SSL 인증서는 90일 동안만 사용이 가능합니다.  자동갱신도 가능합니다.

### SSL 인증서 자동갱신

```jsx
// Crontab 보기
crontab -l

// Crontab 편집
crontab -e
```

```jsx
// 매달 1일에 SSL 인증서 갱신 하는 명령어
0 2 1 * * /usr/bin/certbot renew
```

crontab 편집모드로 들어가서 매달 1일에 자동 갱신되는 명령어를 입력하고 저장합니다.

### 기타 명령어

- `certbot certificates` : SSL 인증서 정보 표시 (만료일 확인 가능)
- `certbot renew —dry-run` : SSL 인증서 갱신 테스트

# SpringBoot 세팅

NginX 설정파일을 직접 설정할 수도 있긴 하지만 더 간편한 방법이 존재하길래 쉬운 길을 선택하였습니다.

### Resources에 SSL 인증서 파일 넣기

![](https://velog.velcdn.com/images/boo105/post/b06f75f6-2d3a-4ba4-aa09-afe18715be28/image.png)

아까 EC2 인스턴스에서 PKCS12 형식으로 변경하고 나면 keystore.p12 파일이 생성 될텐데 그 파일을 `resources/ssl` 에 넣어주시면 됩니다. (저는 파일질라로 가져와서 넣어줬어요.)

### application-dev.proeprties

![](https://velog.velcdn.com/images/boo105/post/cbd1dec4-5dea-485e-b21c-9f06c06d8b35/image.png)

원하시는 properties 파일에 keystore 설정과 port 443(Https) 을 설정해주세요.  
비밀번호는 아까 PKCS12 변경하면서 외워둔 비밀번호를 쓰시면 됩니다.  
스프링부트에서는 설정 이것만 해주시면 끝입니다.

# 결과

![](https://velog.velcdn.com/images/boo105/post/319979b4-0cce-4f84-b913-e2d09b652aee/image.png)